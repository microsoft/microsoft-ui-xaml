parameters:
  name: 'WACKTests'
  dependsOn: ''
  artifactName: 'NugetPkgTestsDrop'
  matrix:
    Release_x86:
      buildPlatform: 'x86'
      buildConfiguration: 'Release'
    Release_x64:
      buildPlatform: 'x64'
      buildConfiguration: 'Release'
    Release_Arm:
      buildPlatform: 'arm'
      buildConfiguration: 'Release'
jobs:
- job: ${{ parameters.name }}
  dependsOn: ${{ parameters.dependsOn }}
  pool:
    name: Package ES Lab E
  strategy:
    maxParallel: 10
    matrix: ${{ parameters.matrix }}

  variables:
    artifactDownloadPath: $(Build.SourcesDirectory)\Artifacts
      
  steps:

  # - task: DownloadBuildArtifacts@0 
  #   inputs: 
  #     artifactName: ${{ parameters.artifactName }} 
  #     downloadPath: '$(artifactDownloadPath)'

  - task: DownloadBuildArtifacts@0 
    inputs: 
      buildType: specific
      buildVersionToDownload: specific
      project: $(System.TeamProjectId)
      pipeline: $(System.DefinitionId)
      buildId: 33645743
      artifactName: ${{ parameters.artifactName }} 
      downloadPath: '$(artifactDownloadPath)'

  - task: PkgESWACKTests@12
    inputs:
      AppxFolder: '$(artifactDownloadPath)\${{parameters.artifactName}}\$(BuildConfiguration)\$(BuildPlatform)\AppxPackages\NugetPackageTestApp_Test'
      WACKFailbuild: true
      
  - task: PkgESWACKTests@12
    inputs:
      AppxFolder: '$(artifactDownloadPath)\${{parameters.artifactName}}\$(BuildConfiguration)\$(BuildPlatform)\AppxPackages\AppThatUsesMUXIndirectly_Test'
      WACKFailbuild: true