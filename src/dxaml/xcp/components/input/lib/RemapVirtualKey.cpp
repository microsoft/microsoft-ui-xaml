// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License. See LICENSE in the project root for license information.

#include <precomp.h>
#include <array>

namespace InputUtility {

// Virtual Key values that are generated by the Gamepad or Remote Control may
// be mapped to standard keyboard key values to enable Controls to leverage
// existing keyboard support.

// Set up mapping tables for keys that may need to be remapped.

struct Entry
{
    wsy::VirtualKey raw;
    wsy::VirtualKey mapped;
};

static const std::array<Entry, 24> s_gamepadArray =
{ {
    { wsy::VirtualKey::VirtualKey_GamepadA, wsy::VirtualKey::VirtualKey_Space },
    { wsy::VirtualKey::VirtualKey_GamepadB, wsy::VirtualKey::VirtualKey_Escape },
    { wsy::VirtualKey::VirtualKey_GamepadX, wsy::VirtualKey::VirtualKey_GamepadX },
    { wsy::VirtualKey::VirtualKey_GamepadY, wsy::VirtualKey::VirtualKey_GamepadY },
    { wsy::VirtualKey::VirtualKey_GamepadRightShoulder, wsy::VirtualKey::VirtualKey_GamepadRightShoulder },
    { wsy::VirtualKey::VirtualKey_GamepadLeftShoulder, wsy::VirtualKey::VirtualKey_GamepadLeftShoulder },
    { wsy::VirtualKey::VirtualKey_GamepadLeftTrigger, wsy::VirtualKey::VirtualKey_GamepadLeftTrigger },
    { wsy::VirtualKey::VirtualKey_GamepadRightTrigger, wsy::VirtualKey::VirtualKey_GamepadRightTrigger },
    { wsy::VirtualKey::VirtualKey_GamepadDPadUp, wsy::VirtualKey::VirtualKey_Up },
    { wsy::VirtualKey::VirtualKey_GamepadDPadDown, wsy::VirtualKey::VirtualKey_Down },
    { wsy::VirtualKey::VirtualKey_GamepadDPadLeft, wsy::VirtualKey::VirtualKey_Left },
    { wsy::VirtualKey::VirtualKey_GamepadDPadRight, wsy::VirtualKey::VirtualKey_Right },
    { wsy::VirtualKey::VirtualKey_GamepadMenu, wsy::VirtualKey::VirtualKey_GamepadMenu },
    { wsy::VirtualKey::VirtualKey_GamepadView, wsy::VirtualKey::VirtualKey_GamepadView },
    { wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickButton, wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickButton },
    { wsy::VirtualKey::VirtualKey_GamepadRightThumbstickButton, wsy::VirtualKey::VirtualKey_GamepadRightThumbstickButton },
    { wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickUp, wsy::VirtualKey::VirtualKey_Up },
    { wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickDown, wsy::VirtualKey::VirtualKey_Down },
    { wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickRight, wsy::VirtualKey::VirtualKey_Right },
    { wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickLeft, wsy::VirtualKey::VirtualKey_Left },
    { wsy::VirtualKey::VirtualKey_GamepadRightThumbstickUp, wsy::VirtualKey::VirtualKey_GamepadRightThumbstickUp },
    { wsy::VirtualKey::VirtualKey_GamepadRightThumbstickDown, wsy::VirtualKey::VirtualKey_GamepadRightThumbstickDown },
    { wsy::VirtualKey::VirtualKey_GamepadRightThumbstickRight, wsy::VirtualKey::VirtualKey_GamepadRightThumbstickRight },
    { wsy::VirtualKey::VirtualKey_GamepadRightThumbstickLeft, wsy::VirtualKey::VirtualKey_GamepadRightThumbstickLeft },
} };

static_assert(wsy::VirtualKey::VirtualKey_GamepadA == wsy::VirtualKey::VirtualKey_GamepadA + 0, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadB == wsy::VirtualKey::VirtualKey_GamepadA + 1, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadX== wsy::VirtualKey::VirtualKey_GamepadA + 2, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadY == wsy::VirtualKey::VirtualKey_GamepadA + 3, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadRightShoulder == wsy::VirtualKey::VirtualKey_GamepadA + 4, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadLeftShoulder == wsy::VirtualKey::VirtualKey_GamepadA + 5, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadLeftTrigger == wsy::VirtualKey::VirtualKey_GamepadA + 6, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadRightTrigger == wsy::VirtualKey::VirtualKey_GamepadA + 7, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadDPadUp == wsy::VirtualKey::VirtualKey_GamepadA + 8, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadDPadDown == wsy::VirtualKey::VirtualKey_GamepadA + 9, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadDPadLeft == wsy::VirtualKey::VirtualKey_GamepadA + 10, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadDPadRight == wsy::VirtualKey::VirtualKey_GamepadA + 11, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadMenu == wsy::VirtualKey::VirtualKey_GamepadA + 12, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadView == wsy::VirtualKey::VirtualKey_GamepadA + 13, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickButton == wsy::VirtualKey::VirtualKey_GamepadA + 14, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadRightThumbstickButton == wsy::VirtualKey::VirtualKey_GamepadA + 15, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickUp == wsy::VirtualKey::VirtualKey_GamepadA + 16, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickDown == wsy::VirtualKey::VirtualKey_GamepadA + 17, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickRight == wsy::VirtualKey::VirtualKey_GamepadA + 18, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadLeftThumbstickLeft == wsy::VirtualKey::VirtualKey_GamepadA + 19, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadRightThumbstickUp == wsy::VirtualKey::VirtualKey_GamepadA + 20, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadRightThumbstickDown == wsy::VirtualKey::VirtualKey_GamepadA + 21, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadRightThumbstickRight == wsy::VirtualKey::VirtualKey_GamepadA + 22, "Value out of sequence");
static_assert(wsy::VirtualKey::VirtualKey_GamepadRightThumbstickLeft == wsy::VirtualKey::VirtualKey_GamepadA + 23, "Value out of sequence");

wsy::VirtualKey RemapVirtualKey(wsy::VirtualKey in)
{
    wsy::VirtualKey out = in;

    if (in >= s_gamepadArray[0].raw && in <= s_gamepadArray.back().raw)
    {
        size_t index = in - s_gamepadArray[0].raw;
        ASSERT(s_gamepadArray[index].raw == in);
        out = s_gamepadArray[index].mapped;
    }

    return out;
}

} // namespace