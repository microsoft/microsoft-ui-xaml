<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. See LICENSE in the project root for license information. -->

<Project DefaultTargets="Build" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <PropertyGroup Label="Globals">
        <ConfigurationType>DynamicLibrary</ConfigurationType>
        <ProjectGuid>{66c7fece-ebb2-4d67-8fa8-bfc1c250e2ee}</ProjectGuid>
    </PropertyGroup>

    <Import Project="$([MSBuild]::GetPathOfFileAbove(Xaml.Cpp.props))"/>
    <Import Project="$(XamlSourcePath)\xcp\project-lift.props"/>
    <Import Project="$(XamlSourcePath)\test\external-dependencies-lift.props"/>
    
    <!-- TAEF.targets always sets INLINE_TEST_METHOD_MARKUP.  We don't want that defined so capture the value before the import and override it
         back to the starting value afterwards. -->
    <ItemDefinitionGroup>
        <ClCompile>
            <BeforeTAEFPreprocessorDefinitions>%(PreprocessorDefinitions)</BeforeTAEFPreprocessorDefinitions>
        </ClCompile>
    </ItemDefinitionGroup>
    <Import Project="$(TaefPkgDirectory)\build\Microsoft.Taef.targets"/>
    <ItemDefinitionGroup>
        <ClCompile>
            <PreprocessorDefinitions>%(BeforeTAEFPreprocessorDefinitions)</PreprocessorDefinitions>
        </ClCompile>
    </ItemDefinitionGroup>

    <PropertyGroup>
        <Dllentry>_DllMainCRTStartup</Dllentry>
        <TargetDestination>$(TestBinplaceDestinationPath)</TargetDestination>
        <XamlDiagPath>$(XamlSourcePath)\xcp\components\xamldiagnostics</XamlDiagPath>
        <XamlDiagObjPath>$(XamlBinaryPath)\xcp\components\xamldiagnostics</XamlDiagObjPath>
        <Mui>false</Mui>
        <ProjectPreprocessorDefinitions>$(ProjectPreprocessorDefinitions) _WCTYPE_INLINE_DEFINED; UNICODE; _UNICODE;</ProjectPreprocessorDefinitions>
    </PropertyGroup>

    <ItemDefinitionGroup>
        <ClCompile>
            <WarningLevel>Level3</WarningLevel>
            <TreatWarningAsError>true</TreatWarningAsError>

            <ExceptionHandling>Sync</ExceptionHandling>
        </ClCompile>
    </ItemDefinitionGroup>

    <PropertyGroup>
        <XamlPrecompiledInclude>precomp.h</XamlPrecompiledInclude>
    </PropertyGroup>

    <ItemGroup>
        <ClInclude Include="precomp.h"/>
        <ClInclude Include="XamlDiagnosticsLauncher.h"/>
        <ClInclude Include="XamlDiagnosticsTap.h"/>

        <ClCompile Include="dllentry.cpp"/>
        <ClCompile Include="XamlDiagnosticsTap.cpp"/>
        <ClCompile Include="XamlDiagnosticsLauncher.cpp"/>
        <ResourceCompile Include="DefaultResource.rc"/>    <!-- Autogenerated file name + version for Device Guard whitelisting effort -->
    </ItemGroup>

    <PropertyGroup>
        <ProjectIncludeDirectories>
            $(VCToolsInstallDir)\Include;
            $(ProjectIncludeDirectories)
            $(LiftedIXPIncludePaths);
            $(ExternalDependencies);
            $(XamlSourcePath)\xcp\components\base\inc;
            $(XamlDiagPath)\inc;
            $(XamlDiagObjPath)\idl;
        </ProjectIncludeDirectories>
    </PropertyGroup>

    <ItemDefinitionGroup>
        <Link>

            <ModuleDefinitionFile>XamlDiagnosticsTap.def</ModuleDefinitionFile>

            <AdditionalDependencies>
                %(AdditionalDependencies);
                onecoreuap.lib;
                $(VCToolsInstallDir)lib\$(WindowsSDKArch)\comsupp.lib;
            </AdditionalDependencies>
        </Link>
    </ItemDefinitionGroup>

    <!-- Autogenerated. Sets file name for Device Guard whitelisting effort, used in RC.exe. -->
    <PropertyGroup>
        <ProjectPreprocessorDefinitions>$(ProjectPreprocessorDefinitions) ___TARGETNAME="""$(TargetName).$(Targettype)""";</ProjectPreprocessorDefinitions>
    </PropertyGroup>

    <ItemGroup>
        <ProjectReference Include="$(XamlDiagPath)\idl\xamlom.vcxproj" Project="{c6e1e90c-ee33-4352-a8de-067b013c7cc9}"/>
    </ItemGroup>

    <Import Project="$([MSBuild]::GetPathOfFileAbove(Microsoft.UI.Xaml.Build.targets))" />
</Project>
